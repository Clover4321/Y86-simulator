<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Y86 Simulator</title>
		
		<link rel="stylesheet" type="text/css" href="./css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="./css/common.css" />
		<script type="text/javascript" src="./js/jquery-1.11.0.min.js"></script>
		<script type="text/javascript" src="./js/jquery.animate-colors-min.js"></script>
		<script type="text/javascript" src="./js/chart.js"></script>
	</head>
	<body>
		<div class="page" id="page1">
		<div class="topArea">
			<div id="drop_area" class="col-md-3">
			Drag and Drop a .yo here to load it
			</div>
			<div class="col-md-6" id="currentStatus">Y86 Simulator</div>
			<div class="col-md-3">
				<form>
					frequency:
					<input type="text" id="frequency" value="2">Hz
				</form>
			</div>
		</div>
        <div class="regContent">
        	<div class="row" id="controlBar1">
	        	<div class="col-md-3"></div>
				<div class="col-md-1">
					<form>
						<img src="./img/last.png" id="lastCycle" onclick="window.VM.CPU.lastCycle()">
					</form>
				</div>
				<div id="currentCycle" class="col-md-4">Cycle Monitor</div>
				<div class="col-md-1">
					<form>
						<img src="./img/next.png" id="nextCycle" onclick="window.VM.CPU.nextCycle();">
					</form>
				</div>
				<div class="col-md-3">
					<image src="./img/start.png" id="run">
					<image src="./img/pause.png" id="pause">
					<image src="./img/reset.png" id="reset">
				</div>
			</div>
			<div class="row" id="regTitle">
				<div id="fetch" class="col-md-2">Fetch</div>
				<div id="decode" class="col-md-2">Decode</div>
				<div id="execute" class="col-md-2">Execute</div>
				<div id="memory" class="col-md-2">Memory</div>
				<div id="write" class="col-md-2">Write</div>
				<div id="register" class="col-md-2">Register</div>
			</div>
			<div class="row">
				<div class="col-md-2" id="F">F_predPC</div>
				<div class="col-md-2" id="D">D_icode</div>
				<div class="col-md-2" id="E">E_icode</div>
				<div class="col-md-2" id="M">M_icode</div>
				<div class="col-md-2" id="W">W_icode</div>
				<div class="col-md-2" id="R">%esp</div>
			</div>
			<div class="row">
				<div class="col-md-2" id="F_predPC">0x0</div>
				<div class="col-md-2" id="D_icode">0x0</div>
				<div class="col-md-2" id="E_icode">0x0</div>
				<div class="col-md-2" id="M_icode">0x0</div>
				<div class="col-md-2" id="W_icode">0x0</div>
				<div class="col-md-2" id="esp">0x0</div>
			</div>
			<div class="row">
				<div class="col-md-2"></div>
				<div class="col-md-2" id="D">D_ifun</div>
				<div class="col-md-2" id="E">E_ifun</div>
				<div class="col-md-2" id="M">M_Bch</div>
				<div class="col-md-2" id="W">W_ValE</div>
				<div class="col-md-2" id="R">%ebp</div>
			</div>
			<div class="row">
				<div class="col-md-2">CPI</div>
				<div class="col-md-2" id="D_ifun">0x0</div>
				<div class="col-md-2" id="E_ifun">0x0</div>
				<div class="col-md-2" id="M_Bch">false</div>
				<div class="col-md-2" id="W_ValE">0x0</div>
				<div class="col-md-2" id="ebp">0x0</div>
			</div>
			<div class="row">
				<div class="col-md-2" id="Show_CPI">1.000</div>
				<div class="col-md-2" id="D">D_rA</div>
				<div class="col-md-2" id="E">E_ValC</div>
				<div class="col-md-2" id="M">M_ValE</div>
				<div class="col-md-2" id="W">W_ValM</div>
				<div class="col-md-2" id="R">%eax</div>
			</div>
			<div class="row">
				<div class="col-md-2"></div>
				<div class="col-md-2" id="D_rA">0x0</div>
				<div class="col-md-2" id="E_ValC">0x0</div>
				<div class="col-md-2" id="M_ValE">0x0</div>
				<div class="col-md-2" id="W_ValM">0x0</div>
				<div class="col-md-2" id="eax">0x0</div>
			</div>
			<div class="row">
				<div class="col-md-2"></div>
				<div class="col-md-2" id="D">D_rB</div>
				<div class="col-md-2" id="E">E_ValA</div>
				<div class="col-md-2" id="M">M_ValA</div>
				<div class="col-md-2" id="W">W_dstE</div>
				<div class="col-md-2" id="R">%ebx</div>
			</div>
			<div class="row">
				<div class="col-md-2"></div>
				<div class="col-md-2" id="D_rB">0x0</div>
				<div class="col-md-2" id="E_ValA">0x0</div>
				<div class="col-md-2" id="M_ValA">0x0</div>
				<div class="col-md-2" id="W_dstE">0x0</div>
				<div class="col-md-2" id="ebx">0x0</div>
			</div>
			<div class="row">
				<div class="col-md-2"></div>
				<div class="col-md-2" id="D">D_ValC</div>
				<div class="col-md-2" id="E">E_ValB</div>
				<div class="col-md-2" id="M">M_dstE</div>
				<div class="col-md-2" id="W">W_dstM</div>
				<div class="col-md-2" id="R">%ecx</div>
			</div>
			<div class="row">
				<div class="col-md-2"></div>
				<div class="col-md-2" id="D_ValC">0x0</div>
				<div class="col-md-2" id="E_ValB">0x0</div>
				<div class="col-md-2" id="M_dstE">0x0</div>
				<div class="col-md-2" id="W_dstM">0x0</div>
				<div class="col-md-2" id="ecx">0x0</div>
			</div>
			<div class="row">
				<div class="col-md-2"></div>
				<div class="col-md-2" id="D">D_ValP</div>
				<div class="col-md-2" id="E">E_dstE</div>
				<div class="col-md-2" id="M">M_dstM</div>
				<div class="col-md-2"></div>
				<div class="col-md-2" id="R">%edx</div>
			</div>
			<div class="row">
				<div class="col-md-2"></div>
				<div class="col-md-2" id="D_ValP">0x0</div>
				<div class="col-md-2" id="E_dstE">0x0</div>
				<div class="col-md-2" id="M_dstM">0x0</div>
				<div class="col-md-2"></div>
				<div class="col-md-2" id="edx">0x0</div>
			</div>
			<div class="row">
				<div class="col-md-2"></div>
				<div class="col-md-2"></div>
				<div class="col-md-2" id="E">E_dstM</div>
				<div class="col-md-2"></div>
				<div class="col-md-2"></div>
				<div class="col-md-2" id="R">%esi</div>
			</div>
			<div class="row">
				<div class="col-md-2"></div>
				<div class="col-md-2"></div>
				<div class="col-md-2" id="E_dstM">0x0</div>
				<div class="col-md-4"></div>
				<div class="col-md-2" id="esi">0x0</div>
			</div>
			<div class="row">
				<div class="col-md-2"></div>
				<div class="col-md-2"></div>
				<div class="col-md-2" id="E">E_srcA</div>
				<div class="col-md-2"></div>
				<div class="col-md-2"></div>
				<div class="col-md-2" id="R">%edi</div>
			</div>
			<div class="row">
				<div class="col-md-4"></div>
				<div class="col-md-2" id="E_srcA">0x0</div>
				<div class="col-md-4"></div>
				<div class="col-md-2" id="edi">0x0</div>
			</div>
			<div class="row">
				<div class="col-md-2"></div>
				<div class="col-md-2"></div>
				<div class="col-md-2" id="E">E_srcB</div>
				<div class="col-md-2"></div>
				<div class="col-md-2"></div>
				<div class="col-md-2"></div>
			</div>
			<div class="row">
				<div class="col-md-4"></div>
				<div class="col-md-2" id="E_srcB">0x0</div>
				<div class="col-md-6"></div>
			</div>
        </div>
        <form id="text-options">
        	<input type="button" value="Y86 Compiler" id="compile" onclick="window.VM.CPU.Y86compiler()">
            Filename: <input type="text" class="filename" id="text-filename" placeholder="asum"/>.txt
            <input type="submit" value="Save">
            <input type="button" id="generateCPIChart" value="generate CPI Chart!"></button>
        </form>
        </div>
        <div class="page" id="page2">
        	
        	<canvas id="CPIChart" width="1024" height="600"></canvas>
        </div>
		<script type="text/javascript" src="./js/FileSaver.js"></script>
		<script type="text/javascript" src="./js/memory.js"></script>
		<script type="text/javascript" src="./js/YOLoader.js"></script>
		<script type="text/javascript" src="./js/kernel.js"></script>
		<script type="text/javascript" src="./js/YOSaver.js"></script>
		<script type="text/javascript">

			var start;
			window.delay = 0;
			var page = 1;

			function startTimer(freq){
				freq = parseFloat(freq);
				if(freq < 1e-8) alert("Invalid frequency!");
				if(freq > 999) alert("Too fast!");
				window.delay = Math.round(1000 / freq);
				start = setInterval("window.VM.CPU.nextCycle()",window.delay);
			}

			$('#run').click(function(){
				if (window.asmIns) {
					startTimer($('#frequency').val());
				}
				else
					alert("Please load .yo file first!");
			});

			$('#pause').click(function(){
				$('#currentCycle').animate({
					backgroundColor:'rgba(255,255,255,0)',
					opacity:1
				},
				window.delay/2);
				clearInterval(start);
			});

			$('#reset').click(function(){
				$('#currentCycle').animate({
					backgroundColor:'rgba(255,255,255,0)',
					opacity:1
				},
				window.delay/2);
				clearInterval(start);
				clearInterval(start);
				window.VM.CPU.reset();
			});

			$('#generateCPIChart').click(function(){
				++ page;
				$('html body').animate({
					scrollTop: $('#page' + page.toString()).offset().top
				}, 1000);
				var data = {
				labels : window.CPI_cycle,
				datasets : [
					{
						fillColor : "rgba(220,220,220,0.5)",
						strokeColor : "rgba(220,220,220,1)",
						pointColor : "rgba(220,220,220,1)",
						pointStrokeColor : "#fff",
						data : window.CPI_value,
					},
				]
				}
				var ctx = $('#CPIChart').get(0).getContext("2d");
				var nChart = new Chart(ctx).Line(data);
			})
		</script>
	</body>
</html>